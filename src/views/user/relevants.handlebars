<div class="jumbotron banner">
  <h1 class="display-4">Seja bem vindo(a), {{nomeuser.nameuser}}!</h1>
  <p class="lead">Temos alguns posts esperando por você.</p>
  <hr class="my-4">
  <p>Que tal compartilhar algo incrível hoje?</p>
  <p class="lead">
    <a href="/user/post">
        <button class="btn btn-primary btnAddPost">Escrever Post
            <span class="material-symbols-outlined">
                notes
            </span>
        </button>
    </a>
    </p>
</div>
 <div class="main-content">
    <div class="side-home-icon">
        <span class="material-symbols-outlined d-none">
            filter_alt
        </span>
        <a href="/user/relevants">
            <li id="btnFilterPoster">
                <span class="textBtn">
                    Posts mais relevântes
                </span>
                <small class="textMob">Mais Curtidos</small>
                <span class="material-symbols-outlined">
                    filter_list
                </span>
            </li>
        </a>
        <form action="/user/searchPost" method="get" class="formSearchPosts">
            <div>
                <label for="searchPosts"></label>
                <input type="text" placeholder="Busque por tag..." class="form-control search" name="tag">
            </div>
            <div>
                <button type="submit" class="btn btn-success">Buscar</button>
            </div>
        </form>
    </div>
    {{#each posts}}
        <div class="container contentPost p-3">
            <div class="card">
                <div class="card-header headerPublic card-publication">
                    <div class="fotoUserPost">
                    {{#if (eq author.profilePicture "/default-profile.png")}}
                        <img src="/uploads/default-profile.png" alt="">
                    {{else}}
                        <img src="https://drive.google.com/thumbnail?id={{author.profilePicture}}" class="imgUserPost" alt="">
                    {{/if}}
                </div>
                <div class="dataPost">
                        <p>Publicação de -
                            <small>
                                <strong>{{this.author.nameuser}} 
                                    {{#if (eq this.author.role "SUPER_ADMIN")}}
                                        <span class="text-danger tagSA">
                                            {{this.author.role}}
                                        </span>
                                    {{else if (eq this.author.role "admin")}}
                                        <span class="text-success">
                                            {{this.author.role}}
                                        </span>
                                    {{!-- {{else if (eq this.author.role "user")}} --}}
                                    {{/if}}
                                </strong>
                            </small>
                        </p>
                        <div>
                            <small>publicado em {{this.createdDate}}</small>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <h2>{{this.titulo}}</h2>
                    <hr>
                    <p>{{{this.conteudo}}}</p>
                </div>
                <div class="card-footer actionBtn b-3">
                    <div class="like" id="like-buttom-{{this._id}}">
                        <span title="-"  class="material-symbols-outlined likeIcon">
                            thumb_up
                        </span>
                        <span class="like-counts">{{this.likes.length}}</span>
                    </div>
                    <div class="coments">
                    <button data-post-id="{{this._id}}" onclick="openComments(this)" class="btnAtiveComments">
                        <input type="hidden" id="id-{{this._id}}" class="id" value="{{this._id}}">
                        <span class="material-symbols-outlined commentIcon">
                            comment
                        </span>
                    </button>
                    <span class="comments-counts">{{this.comentarios.length}}</span>
                </div>
                    {{!-- <div class="share">
                        <span class="material-symbols-outlined shareIcon">
                            share
                        </span>
                    </div> --}}
                </div>
                <div class="p-3">
                    <strong>tags:</strong>
                    {{#each tags}}
                        <span class="tagStyle">{{this}}</span>
                    {{/each}}
                </div>
            </div>
        </div>
        {{!-- Janela de comentários --}}
    <div class="windowComments" id="windowComments-{{this._id}}">
        <button class="btnCloseComments">
            <span class="material-symbols-outlined iconCloseComments" id="closeComments" onclick="CloseComment()">
                keyboard_double_arrow_down
            </span>
        </button>
        <div class="containerComments" onclick="quantCommentsPosts(this)">
            <div class="localComments">
                {{#if this.comentarios.length}}
                {{#each this.comentarios}}
                <div class="CommentStyle">
                    <div class="userInfoComment">
                        <div class="nameAuthorComment">
                            {{author.nameuser}}
                        </div>
                        <div>
                            {{#if (eq author.profilePicture "/default-profile.png")}}
                            <img src="https://drive.google.com/thumbnail?id=1NT1cawdfecDY3W-YTfFkiyHHAQItTwB9" alt=""
                                class="imgUserComent">
                            {{else}}
                            <img title="{{author.biography}}"
                                src="https://drive.google.com/thumbnail?id={{author.profilePicture}}"
                                class="imgUserComent" alt="">
                            {{/if}}
                        </div>
                    </div>
                    <div>
                        <div>
                            {{text}}
                        </div>
                    </div>
                </div>
                {{/each}}
                {{else}}
                <p>Seja o primeiro(a) a comentar aqui!</p>
                {{/if}}
            </div>
        </div>
        <form action="/user/home/comment" class="form-comment" method="post">
            <input type="hidden" value="{{author._id}}" id="userIdComment" name="author">
            <input type="hidden" value="{{this._id}}" name="post" id="postId" class="postId">
            <div class="mb-3 localText">
                <label for="comment"></label>
                <textarea placeholder="O que achou disso?" name="text" class="form-control coment-input"
                    id=""></textarea>
            </div>
            <button type="submit" class="btnSendComment">
                <span class="material-symbols-outlined sendComment">
                    send
                </span>
            </button>
        </form>
    </div>
    {{!-- Janela de informação de usuários --}}
    <div class="cardProfile" id="cardProfile-{{this._id}}">
        <div class="card cardProfileData" style="width: 18rem;">
            <div class="closeCardProfile" id="closeCardProfile">
                <span class="material-symbols-outlined iconCloseProfile" id="iconCloseProfile"
                    onclick="closeInfoUser()">
                    cancel
                </span>
            </div>
            {{#if (eq author.profilePicture "/default-profile.png")}}
            <img src="https://drive.google.com/thumbnail?id=1NT1cawdfecDY3W-YTfFkiyHHAQItTwB9"
                class="cardPhot card-img-top" alt="" class="card-img-top">
            {{else}}
            <img src="https://drive.google.com/thumbnail?id={{author.profilePicture}}" class="cardPhot card-img-top"
                alt="">
            {{/if}}
            <div class="card-body body-biography-card">
                <h5 class="card-title">Biografia</h5>
                <hr>
                <p class="card-text">{{author.biography}}</p>
                {{!-- <div class="d-flex justify-content-center">
                    <a href="#" class="btn btn-primary">Seguir</a>
                </div> --}}
            </div>
        </div>
    </div>
    {{else}}
    <p>Nenhum post</p>
{{/each}}
</div>

<script>
    function openComments(id){
    const BtnId = id.getAttribute('data-post-id')
    const comment = document.getElementById(`windowComments-${BtnId}`)
    comment.classList.add('ativeWindowComments')
}


function CloseComment(){
    const closeWindow = document.querySelectorAll('.windowComments')
    closeWindow.forEach(window => window.classList.remove('ativeWindowComments'))
}
</script>